# 本番運用チェックリスト

## 環境変数・設定

- [ ] 本番環境の環境変数を設定（Vercel環境変数設定）
  - [ ] `COOKIE_SIGNATURE_KEY_1` をランダム文字列（32文字以上）に変更
  - [ ] `COOKIE_SIGNATURE_KEY_2` をランダム文字列（32文字以上）に変更
  - [ ] `FIREBASE_PROJECT_ID` を設定
  - [ ] `FIREBASE_CLIENT_EMAIL` を設定
  - [ ] `FIREBASE_PRIVATE_KEY` を設定（改行文字含む）
  - [ ] `NEXT_PUBLIC_FIREBASE_*` 変数を設定
- [ ] `.env.local` から本番環境変数への移行確認
- [x] 環境変数の値がコードにハードコードされていないか確認

## セキュリティ

- [x] Firestoreセキュリティルールを作成・デプロイ
  - [x] `users` コレクション: adminのみ読み書き可能
  - [x] `projects` コレクション: 認証済みユーザーのみ読み書き可能
  - [x] `projects/{projectId}/documents` サブコレクション: 認証済みユーザーのみ読み書き可能
  - [x] `projects/{projectId}/activityLogs` サブコレクション: 認証済みユーザーのみ読み取り、書き込みはサーバー側のみ
- [x] Cloud Storageセキュリティルールを作成・デプロイ
  - [x] `projects/{projectId}/documents/*` パス: 認証済みユーザーのみ読み書き可能
- [x] Cookie設定の確認（`secure: true` が本番で有効か）
- [ ] HTTPSの強制確認
- [ ] Firebase Authenticationの設定確認
  - [ ] 認証済みドメインにVercelのドメインを追加（`auth/unauthorized-domain`エラー回避）
    - [ ] プロダクションドメイン（`your-project-name.vercel.app`）
    - [ ] カスタムドメイン（設定している場合）
  - [ ] 許可するメールドメインの制限（必要に応じて）
  - [ ] パスワードポリシーの設定

## Firebase設定

- [ ] Firebaseプロジェクトの本番環境準備
  - [ ] 本番用Firebaseプロジェクトの作成（開発環境と分離する場合）
  - [ ] Firestoreデータベースの作成
  - [ ] Cloud Storageバケットの作成
- [ ] Firebase Service Accountの設定
  - [ ] サービスアカウントキーの生成
  - [ ] 最小権限の原則に従った権限設定
- [ ] Firebase Authenticationの有効化
  - [ ] メール/パスワード認証の有効化
- [ ] Firestoreインデックスの作成
  - [ ] 複合クエリで使用するインデックスの確認・作成

## デプロイ

- [ ] Vercelプロジェクトの作成・設定
- [ ] カスタムドメインの設定（必要に応じて）
- [ ] ビルドエラーの確認
  - [ ] `npm run build` が成功するか
  - [ ] TypeScriptエラーがないか
  - [ ] リンターエラーがないか
- [ ] 本番環境での動作確認
  - [ ] ログイン機能
  - [ ] プロジェクト作成・編集
  - [ ] ドキュメントアップロード
  - [ ] ユーザー管理（admin機能）

## データ管理

- [ ] 初期データの準備
  - [ ] 管理者アカウントの作成
  - [ ] サンプルデータの投入（`npm run seed`）
- [ ] データバックアップ設定
  - [ ] Firestoreの自動バックアップ設定
  - [ ] バックアップからの復旧手順の確認
- [ ] データマイグレーション手順の文書化（必要に応じて）

## エラーハンドリング・監視

- [ ] エラー監視ツールの導入
  - [ ] Sentry等のエラートラッキング設定
  - [ ] エラー通知の設定
- [ ] ログ設定
  - [ ] 本番環境でのログレベル設定
  - [ ] ログの集約・保存設定

## テスト

- [ ] 機能テスト
  - [ ] 主要機能の動作確認
  - [ ] エッジケースのテスト
- [ ] ブラウザ互換性テスト
  - [ ] Chrome, Firefox, Safari, Edgeでの動作確認
- [ ] モバイル対応確認
  - [ ] レスポンシブデザインの確認
  - [ ] タッチ操作の確認

## コード品質

- [x] デバッグコードの削除
  - [x] `console.log` の削除または本番用ログレベル設定
  - [x] 開発用のコメントアウトコードの削除
  - [x] テスト用のハードコード値の削除
- [ ] 型安全性の確認
  - [ ] TypeScriptのstrictモード確認
  - [ ] 型エラーの解消
- [ ] セキュリティ脆弱性の確認
  - [x] `npm audit` の実行と修正
  - [x] 依存関係の更新確認（更新可能なパッケージを確認済み）

## ドキュメント

- [ ] デプロイ手順の文書化
- [ ] 環境変数の説明文書化（`VERCEL_ENV_VARS.md` を更新）
- [ ] トラブルシューティングガイドの作成
- [ ] アーキテクチャ図の作成（必要に応じて）
